/* ================================================================================
-- TEP 1: 01_RUN_AS_SYSDBA.sql
-- CHAY VOI QUYEN: SYS AS SYSDBA
-- MUC DICH: TAO USER QLTS VA CAP TAT CA QUYEN HE THONG
================================================================================

ALTER SESSION SET "_ORACLE_SCRIPT"= true;

/* ----- TAO USER QLTS ----- */
CREATE USER QLTS IDENTIFIED BY qlts
DEFAULT TABLESPACE USERS
QUOTA UNLIMITED ON USERS;

/* ----- CAP QUYEN CO BAN ----- */
GRANT CONNECT, RESOURCE TO QLTS;
GRANT CREATE VIEW, CREATE PROCEDURE, CREATE TRIGGER TO QLTS;

/* ----- CAP QUYEN MA HOA (AES, RSA) ----- */
GRANT EXECUTE ON SYS.DBMS_CRYPTO TO QLTS;

/* ----- Cap quyen su dung package UTL_I18N cho QLTS ------- */
GRANT EXECUTE ON SYS.UTL_I18N TO QLTS;

/* ----- CAP QUYEN BAO MAT NANG CAO (PROFILE, SESSION) ----- */
GRANT CREATE PROFILE TO QLTS;
GRANT CREATE TABLESPACE TO QLTS;
GRANT ALTER SYSTEM TO QLTS; -- (De kill session)

GRANT SELECT ON v_$session TO QLTS;
GRANT SELECT ON dba_free_space TO QLTS;
GRANT SELECT ON dba_data_files TO QLTS;

/* ----- CAP QUYEN QUAN LY ROLE ----- */
GRANT CREATE USER, ALTER USER, DROP USER TO QLTS;
GRANT CREATE ROLE, DROP ANY ROLE TO QLTS;
GRANT GRANT ANY ROLE TO QLTS;

GRANT SELECT ON dba_users TO QLTS;
GRANT SELECT ON dba_roles TO QLTS;
GRANT SELECT ON dba_role_privs TO QLTS;

/* ----- CAP QUYEN CHO VPD (VIRTUAL PRIVATE DATABASE) ----- */
GRANT CREATE ANY CONTEXT TO QLTS;
GRANT EXECUTE ON SYS.DBMS_RLS TO QLTS;

/* ----- CAP QUYEN CHO FGA (GIAM SAT) & FLASHBACK (PHUC HOI) ----- */
GRANT EXECUTE ON SYS.DBMS_FGA TO QLTS;
GRANT SELECT ON DBA_FGA_AUDIT_TRAIL TO QLTS;
-- (Luu y: Quyen FLASHBACK se duoc cap o Buoc 4, sau khi bang SANPHAM duoc tao)

/* ----- CAP QUYEN CHO OLS (ORACLE LABEL SECURITY) ----- */
-- 1. Cap quyen quan ly chinh sach OLS
GRANT LBAC_DBA TO QLTS;

-- 2. Cap quyen thuc thi cac ham OLS trong session
GRANT EXECUTE ON SA_SYSDBA TO QLTS;
GRANT EXECUTE ON SA_COMPONENTS TO QLTS;
GRANT EXECUTE ON SA_POLICY_ADMIN TO QLTS;
GRANT EXECUTE ON SA_SESSION TO QLTS; -- (Quan trong cho C#)
GRANT EXECUTE ON CHAR_TO_LABEL TO QLTS;

/* Cap quyen cho Ma hoa */
GRANT EXECUTE ON SYS.DBMS_CRYPTO TO QLTS;

/* Cap quyen cho (STRING_TO_RAW, RAW_TO_STRING) */

GRANT EXECUTE ON SYS.UTL_I18N TO QLTS;

/* Cap quyen cho (CAST_TO_RAW) */

GRANT EXECUTE ON SYS.UTL_RAW TO QLTS;

GRANT CREATE SYNONYM TO QLTS;

/* Luu lai quyen */
COMMIT;